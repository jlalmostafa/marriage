<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>عروض العقارات</title>
    
    <!-- الروابط الخارجية -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
        }
        
        /* المحتوى الرئيسي */
        .main-content {
            flex: 1;
            padding: 30px 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .logo {
            font-size: 3.5rem;
            color: #3b82f6;
            margin-bottom: 20px;
            text-shadow: 0 4px 20px rgba(59, 130, 246, 0.3);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 15px;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 700;
        }
        
        .description {
            font-size: 1.1rem;
            line-height: 1.6;
            color: #94a3b8;
            margin-bottom: 40px;
            max-width: 600px;
        }
        
        /* شريط التنقل السفلي */
        .bottom-nav-bar {
            position: fixed;
            bottom: 0;
            right: 0;
            width: 100%;
            height: 40px;
            
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(59, 130, 246, 0.2);
            box-shadow: 0 -10px 40px rgba(0, 0, 0, 0.4);
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 1000;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .bottom-nav-bar:hover {
            box-shadow: 0 -15px 50px rgba(0, 0, 0, 0.5);
            border-top-color: rgba(59, 130, 246, 0.4);
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            color: #94a3b8;
            transition: all 0.3s ease;
            position: relative;
            padding: 8px 20px;
            border-radius: 12px;
            flex: 1;
            max-width: 180px;
            height: 55px;
        }
        
        .nav-item:hover {
            color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
            transform: translateY(-5px);
        }
        
        .nav-item.active {
            color: #3b82f6;
        }
        
        .nav-item.active::before {
            content: '';
            position: absolute;
            top: -8px;
            width: 6px;
            height: 6px;
            background-color: #3b82f6;
            border-radius: 50%;
            box-shadow: 0 0 10px #3b82f6;
        }
        
        .nav-item.active .nav-icon {
            animation: iconFloat 3s ease-in-out infinite;
        }
        
        .nav-icon {
            font-size: 1.8rem;
            margin-bottom: 5px;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .nav-icon::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 2px;
            background: #3b82f6;
            transition: width 0.3s ease;
        }
        
        .nav-item.active .nav-icon::after,
        .nav-item:hover .nav-icon::after {
            width: 100%;
        }
        
        .nav-text {
            font-size: 0.85rem;
            font-weight: 600;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            transition: all 0.3s ease;
        }
        
        .nav-item:hover .nav-text {
            color: #60a5fa;
        }
        
        /* تأثير الأنميشن */
        @keyframes iconFloat {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-5px);
            }
        }
        
        /* المؤشر */
        .nav-indicator {
            position: absolute;
            top: -15px;
            height: 3px;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
            border-radius: 3px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1001;
        }
        
        /* تصميم متجاوب */
        @media (max-width: 768px) {
            .bottom-nav-bar {
                height: 65px;
            }
            
            .nav-item {
                padding: 6px 15px;
                height: 50px;
            }
            
            .nav-icon {
                font-size: 1.6rem;
            }
            
            .nav-text {
                font-size: 0.75rem;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .description {
                font-size: 1rem;
                padding: 0 15px;
            }
        }
        
        @media (max-width: 480px) {
            .bottom-nav-bar {
                height: 60px;
            }
            
            .nav-item {
                padding: 5px 10px;
                height: 45px;
            }
            
            .nav-icon {
                font-size: 1.4rem;
                margin-bottom: 3px;
            }
            
            .nav-text {
                font-size: 0.7rem;
            }
            
            h1 {
                font-size: 1.8rem;
            }
        }
        
        /* تأثير النقر */
        .nav-item:active {
            transform: scale(0.95);
        }
        
        /* إشعار */
        .notification {
            position: absolute;
            top: -8px;
            right: 20px;
            background: #ef4444;
            color: white;
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 10px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
            }
            50% {
                box-shadow: 0 0 0 6px rgba(239, 68, 68, 0);
            }
        }
    </style>
    <!-- الأنماط الرئيسية -->
    <style>
        /* إعادة تعيين وتحسين عام */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            direction: rtl;
            background-color: #f0f2f5;
            color: #1c1e21;
            line-height: 1.34;
            min-height: 100vh;
            padding-top: 60px;
        }
        
        /* الهيدر العلوي */
        .top-header {
            position: fixed;
            top: 0;
            right: 0;
            width: 100%;
            height: 60px;
            background-color: #ffffff;
            border-bottom: 1px solid #dddfe2;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            padding: 0 20px;
            z-index: 1000;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            margin-left: 20px;
        }
        
        .logo {
            font-size: 24px;
            color: #1877f2;
            margin-left: 10px;
        }
        
        .site-title {
            font-size: 20px;
            font-weight: 600;
            color: #1c1e21;
        }
        
        /* شريط التصفية العلوي */
        .filter-bar {
            background-color: #ffffff;
            padding: 12px 20px;
            border-bottom: 1px solid #dddfe2;
            position: sticky;
            top: 60px;
            z-index: 999;
            display: flex;
            gap: 15px;
            align-items: center;
            overflow-x: auto;
            white-space: nowrap;
        }
        
        .filter-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .filter-label {
            font-size: 14px;
            color: #65676b;
            font-weight: 500;
        }
        
        .filter-select {
            padding: 8px 12px;
            border: 1px solid #dddfe2;
            border-radius: 6px;
            background-color: #f0f2f5;
            font-size: 14px;
            color: #1c1e21;
            min-width: 120px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .filter-select:focus {
            outline: none;
            border-color: #1877f2;
            background-color: #ffffff;
        }
        
        .property-count {
            font-size: 14px;
            color: #65676b;
            margin-right: auto;
        }
        
        /* المحتوى الرئيسي */
        .main-content {
            max-width: 680px;
            margin: 0 auto;
            padding: 16px;
        }
        
        /* نموذج الإضافة العلوي */
        .add-form-container {
            background-color: #ffffff;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
            border: 1px solid #dddfe2;
            display: none;
        }
        
        .add-form-container.active {
            display: block;
        }
        
        .form-header {
            display: flex;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid #dddfe2;
        }
        
        .form-title {
            font-size: 18px;
            font-weight: 600;
            color: #1c1e21;
        }
        
        .close-form-btn {
            margin-right: auto;
            background: none;
            border: none;
            font-size: 20px;
            color: #65676b;
            cursor: pointer;
            padding: 4px;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .close-form-btn:hover {
            background-color: #f0f2f5;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-bottom: 16px;
        }
        
        .form-group {
            margin-bottom: 12px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 6px;
            font-size: 14px;
            color: #65676b;
            font-weight: 500;
        }
        
        .form-input, .form-select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #dddfe2;
            border-radius: 6px;
            background-color: #f0f2f5;
            font-size: 14px;
            color: #1c1e21;
            transition: all 0.2s;
        }
        
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #1877f2;
            background-color: #ffffff;
        }
        
        .radio-group {
            display: flex;
            gap: 16px;
            margin-top: 8px;
        }
        
        .radio-option {
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
        }
        
        .radio-input {
            width: 16px;
            height: 16px;
            accent-color: #1877f2;
        }
        
        .form-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid #dddfe2;
        }
        
        .submit-btn {
            background-color: #1877f2;
            color: white;
            border: none;
            padding: 10px 24px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .submit-btn:hover {
            background-color: #166fe5;
        }
        
        .cancel-btn {
            background-color: #e4e6eb;
            color: #1c1e21;
            border: none;
            padding: 10px 24px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .cancel-btn:hover {
            background-color: #d8dadf;
        }
        
        /* بطاقات العقارات */
        .listings-container {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .listing-card {
            background-color: #ffffff;
            border-radius: 8px;
            border: 1px solid #dddfe2;
            overflow: hidden;
        }
        
        .video-container {
            position: relative;
            padding-bottom: 56.25%;
            height: 0;
            overflow: hidden;
            background-color: #000;
        }
        
        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }
        
        .listing-content {
            padding: 16px;
        }
        
        .listing-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }
        
        .listing-title {
            font-size: 16px;
            font-weight: 600;
            color: #1c1e21;
            line-height: 1.4;
            flex: 1;
        }
        
        .price-tag {
            background-color: #e7f3ff;
            color: #1877f2;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 15px;
            font-weight: 600;
            margin-right: 12px;
        }
        
        .listing-details {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 16px;
        }
        
        .detail-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
            color: #65676b;
        }
        
        .detail-icon {
            color: #1877f2;
            font-size: 14px;
        }
        
        .status-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status-ready {
            background-color: #e7f6ea;
            color: #0a7c2f;
        }
        
        .status-not-ready {
            background-color: #fef2e8;
            color: #c55400;
        }
        
        .action-buttons {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid #dddfe2;
        }
        
        .action-btn {
            flex: 1;
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        
        .action-btn i {
            font-size: 14px;
        }
        
        .like-btn {
            background-color: #f0f2f5;
            color: #65676b;
        }
        
        .like-btn:hover {
            background-color: #e4e6eb;
        }
        
        .comment-btn {
            background-color: #f0f2f5;
            color: #65676b;
        }
        
        .comment-btn:hover {
            background-color: #e4e6eb;
        }
        
        .view-comments-btn {
            background-color: #f0f2f5;
            color: #65676b;
        }
        
        .view-comments-btn:hover {
            background-color: #e4e6eb;
        }
        
        .whatsapp-btn {
            background-color: #25D366;
            color: white;
            text-decoration: none;
            padding: 10px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: background-color 0.2s;
            cursor: pointer;
        }
        
        .whatsapp-btn:hover {
            background-color: #1da851;
        }
        
        /* التعليقات */
        .comments-section {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            margin-top: 12px;
        }
        
        .comments-section.expanded {
            max-height: 400px;
        }
        
        .comments-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #dddfe2;
        }
        
        .comments-title {
            font-size: 15px;
            font-weight: 600;
            color: #1c1e21;
        }
        
        .comments-list {
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 12px;
        }
        
        .comment-item {
            background-color: #f0f2f5;
            padding: 10px 12px;
            margin-bottom: 8px;
            border-radius: 8px;
            font-size: 14px;
            line-height: 1.4;
            color: #1c1e21;
        }
        
        .comment-form {
            margin-top: 12px;
        }
        
        .comment-textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #dddfe2;
            border-radius: 6px;
            background-color: #f0f2f5;
            font-size: 14px;
            color: #1c1e21;
            resize: vertical;
            min-height: 80px;
            margin-bottom: 8px;
        }
        
        .comment-textarea:focus {
            outline: none;
            border-color: #1877f2;
            background-color: #ffffff;
        }
        
        .submit-comment-btn {
            background-color: #1877f2;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .submit-comment-btn:hover {
            background-color: #166fe5;
        }
        
        .submit-comment-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        /* قسم التحقق العلوي */
        .verify-section {
            background-color: #ffffff;
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 16px;
            border: 1px solid #dddfe2;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .verify-input {
            flex: 1;
            padding: 10px 12px;
            border: 1px solid #dddfe2;
            border-radius: 6px;
            font-size: 14px;
            color: #1c1e21;
        }
        
        .verify-input:focus {
            outline: none;
            border-color: #1877f2;
        }
        
        .verify-btn {
            background-color: #1877f2;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .verify-btn:hover {
            background-color: #166fe5;
        }
        
        .result-message {
            padding: 10px 12px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            margin-top: 8px;
            display: none;
        }
        
        .success-message {
            background-color: #e7f6ea;
            color: #0a7c2f;
            border: 1px solid #a8e6b9;
        }
        
        .error-message {
            background-color: #fde8e8;
            color: #c53030;
            border: 1px solid #fecaca;
        }
        
        /* رسائل الحالة */
        .no-results {
            text-align: center;
            padding: 40px 20px;
            background-color: #ffffff;
            border-radius: 8px;
            border: 1px solid #dddfe2;
        }
        
        .no-results i {
            font-size: 48px;
            color: #bec3c9;
            margin-bottom: 16px;
        }
        
        .no-results h3 {
            font-size: 18px;
            color: #1c1e21;
            margin-bottom: 8px;
        }
        
        .no-results p {
            font-size: 14px;
            color: #65676b;
        }
        
        .loading {
            text-align: center;
            padding: 40px 20px;
            color: #65676b;
            font-size: 14px;
        }
        
        .error-display {
            background-color: #fde8e8;
            color: #c53030;
            padding: 16px;
            border-radius: 8px;
            border: 1px solid #fecaca;
            margin-bottom: 16px;
        }
        
        .success-display {
            background-color: #e7f6ea;
            color: #0a7c2f;
            padding: 16px;
            border-radius: 8px;
            border: 1px solid #a8e6b9;
            margin-bottom: 16px;
        }
        
        /* التصميم المتجاوب */
        @media (max-width: 768px) {
            .top-header {
                padding: 0 16px;
                height: 56px;
            }
            
            .site-title {
                font-size: 18px;
            }
            
            .filter-bar {
                padding: 10px 16px;
                top: 56px;
            }
            
            .main-content {
                padding: 12px;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-wrap: wrap;
            }
            
            .action-btn {
                min-width: calc(33.333% - 6px);
            }
            
            .verify-section {
                flex-direction: column;
                align-items: stretch;
            }
            
            .verify-btn {
                width: 100%;
                justify-content: center;
            }
        }
        
        @media (max-width: 480px) {
            .top-header {
                padding: 0 12px;
            }
            
            .logo {
                font-size: 20px;
            }
            
            .site-title {
                font-size: 16px;
            }
            
            .filter-bar {
                padding: 8px 12px;
            }
            
            .filter-select {
                min-width: 100px;
                padding: 6px 10px;
                font-size: 13px;
            }
            
            .filter-label {
                font-size: 13px;
            }
            
            .property-count {
                font-size: 13px;
            }
            
            .listing-header {
                flex-direction: column;
                gap: 8px;
            }
            
            .price-tag {
                align-self: flex-start;
                margin-right: 0;
            }
            
            .action-btn {
                min-width: calc(50% - 4px);
                font-size: 12px;
                padding: 6px 8px;
            }
        }
        
        /* تحسينات للتمرير */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f0f2f5;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #bec3c9;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #a8adb3;
        }
        
        /* تأثيرات إضافية */
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
    </style>
</head>
<body>
    <!-- الهيدر العلوي -->
    <header class="top-header">
        <div class="logo-container">
            <div class="logo">
                <i class="fas fa-home"></i>
            </div>
            <div class="site-title">عروض العقارات</div>
        </div>
    </header>
    
    <!-- شريط التصفية العلوي -->
    <div class="filter-bar" id="filterBar">
        <div class="filter-group">
            <span class="filter-label">السعر:</span>
            <select class="filter-select" id="priceFilter">
                <option value="all">الكل</option>
                <option value="5000-10000">5K-10K $</option>
                <option value="10000-15000">10K-15K $</option>
                <option value="15000+">15K+ $</option>
            </select>
        </div>
        
        <div class="filter-group">
            <span class="filter-label">الحالة:</span>
            <select class="filter-select" id="readyFilter">
                <option value="all">الكل</option>
                <option value="T">جاهز</option>
                <option value="F">تحت الإنشاء</option>
            </select>
        </div>
        
        <div class="filter-group">
            <span class="filter-label">المنطقة:</span>
            <select class="filter-select" id="areaFilter">
                <option value="all">الكل</option>
                <option value="a">إدلب</option>
                <option value="b">سلقين</option>
                <option value="c">جسر الشغور</option>
                <option value="d">أريحا</option>
                <option value="e">سرمدا</option>
            </select>
        </div>
    </div>
    
    <!-- المحتوى الرئيسي -->
    <main class="main-content">
        <!-- قسم التحقق العلوي -->

        
        <div class="result-message" id="codeResult"></div>
        
        <!-- نموذج الإضافة العلوي -->
        <div class="add-form-container" id="addFormContainer">
            <div class="form-header">
                <h3 class="form-title">إضافة عقار جديد</h3>
                <button class="close-form-btn" id="closeFormBtn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="dataForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label" for="videoUrl1">رابط الفيديو</label>
                        <input type="url" class="form-input" id="videoUrl1" required placeholder="رابط يوتيوب" dir="ltr">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="price1">السعر ($)</label>
                        <input type="number" class="form-input" id="price1" required placeholder="السعر بالدولار">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="description1">الوصف</label>
                        <input type="text" class="form-input" id="description1" required placeholder="وصف العقار">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="region1">المنطقة</label>
                        <select class="form-select" id="region1" required>
                            <option value="">اختر المنطقة</option>
                            <option value="a">إدلب</option>
                            <option value="b">سلقين</option>
                            <option value="c">جسر الشغور</option>
                            <option value="d">أريحا</option>
                            <option value="e">سرمدا</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">الحالة</label>
                        <div class="radio-group">
                            <label class="radio-option">
                                <input type="radio" class="radio-input" name="ready1" value="T" required>
                                <span>جاهز</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" class="radio-input" name="ready1" value="F" required>
                                <span>غير جاهز</span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="submit-btn">
                        <i class="fas fa-plus"></i> إضافة العقار
                    </button>
                    <button type="button" class="cancel-btn" id="cancelBtn">
                        إلغاء
                    </button>
                </div>
            </form>
            
            <div id="formResult"></div>
        </div>
        
        <!-- قائمة العقارات -->
        <div class="listings-container" id="listingsContainer">
            <div class="loading" id="loadingMessage">
                <i class="fas fa-spinner fa-spin"></i> جاري تحميل العروض...
            </div>
        </div>
    </main>
            <div class="verify-section" id="verifySection">
            <input type="password" class="verify-input" id="secretCodeInput" placeholder="أدخل كلمة المرور لإضافة عقار جديد">
            <button class="verify-btn" id="verifyBtn">
                <i class="fas fa-key"></i> تحقق
            </button>
        </div>
        <br>
        <br/>
        <br>
    <!-- شريط التنقل السفلي -->
    <nav class="bottom-nav-bar" id="bottomNavBar">
        <div class="nav-indicator" id="navIndicator"></div>
        
        <a href="https://ldlib-real-estate.netlify.app/" class="nav-item active" id="navMap">
            <div class="nav-icon">
                <i class="fas fa-map-marked-alt"></i>
            </div>
            <div class="nav-text">الخريطة العقارية</div>
        </a>
        
        <a href="https://ldlib-real-estate.netlify.app/iidd.html" class="nav-item" id="navVideo">
            <div class="nav-icon">
                <i class="fas fa-video"></i>
                <span class="notification" id="propertyCount">3</span>
            </div>
            <div class="nav-text">عروض الفيديو</div>
        </a>
    </nav>

    <!-- السكريبت الرئيسي -->
    <script>
        // البيانات والمتغيرات العامة
        let allListings = [];
        const GOOGLE_SHEET_ID = '1851C5ECZgAm4sipw9zXTTOvD_cSoIXxjRHx6XzbBgtY';
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbw27JTgyMyc9S09R9kLvC5-ZFPRx-r06sdqS2eEi2entBoTL3CSTgsqo4zlEfpmY12O/exec';
        const WHATSAPP_NUMBER = '+963969 315 579'; // رقم الواتساب
        
        // تهيئة الصفحة عند التحميل
        document.addEventListener('DOMContentLoaded', function() {
            // إضافة مستمعات الأحداث للفلاتر
            document.querySelectorAll('#priceFilter, #readyFilter, #areaFilter').forEach(filter => {
                filter.addEventListener('change', applyFilters);
            });
            
            // زر التحقق
            document.getElementById('verifyBtn').addEventListener('click', checkSecretCode);
            
            // زر الإدخال بالإنتر
            document.getElementById('secretCodeInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    checkSecretCode();
                }
            });
            
            // زر إغلاق النموذج
            document.getElementById('closeFormBtn').addEventListener('click', function() {
                document.getElementById('addFormContainer').classList.remove('active');
                document.getElementById('dataForm').reset();
                document.getElementById('formResult').innerHTML = '';
            });
            
            // زر الإلغاء
            document.getElementById('cancelBtn').addEventListener('click', function() {
                document.getElementById('addFormContainer').classList.remove('active');
                document.getElementById('dataForm').reset();
                document.getElementById('formResult').innerHTML = '';
            });
            
            // إرسال النموذج
            document.getElementById('dataForm').addEventListener('submit', handleFormSubmit);
            
            // جلب البيانات الأولية
            fetchData();
        });
        
        // تحويل روابط اليوتيوب
        function parseVideoUrl(videoUrl) {
            if (!videoUrl) return "";
            
            try {
                let videoId = '';
                
                if (videoUrl.includes("youtube.com/watch?v=")) {
                    videoId = videoUrl.split("v=")[1].split("&")[0];
                } 
                else if (videoUrl.includes("youtu.be/")) {
                    videoId = videoUrl.split("youtu.be/")[1].split("?")[0];
                }
                else if (videoUrl.includes("youtube.com/shorts/")) {
                    videoId = videoUrl.split("shorts/")[1].split("?")[0];
                }
                else if (videoUrl.includes("youtube.com/embed/")) {
                    videoId = videoUrl.split("embed/")[1].split("?")[0];
                }
                
                if (videoId) {
                    return `https://www.youtube.com/embed/${videoId}?rel=0&showinfo=0&autoplay=0`;
                }
                return videoUrl;
            } catch (e) {
                console.error("خطأ في تحليل رابط الفيديو:", e);
                return videoUrl;
            }
        }
        
        // تحويل رمز المنطقة إلى اسم
        function getAreaName(areaCode) {
            const areas = {
                'a': 'إدلب',
                'b': 'سلقين',
                'c': 'جسر الشغور',
                'd': 'أريحا',
                'e': 'سرمدا'
            };
            return areas[areaCode] || areaCode;
        }
        
        // جلب البيانات من Google Sheets
        async function fetchData() {
            const url = `https://docs.google.com/spreadsheets/d/${GOOGLE_SHEET_ID}/export?format=xlsx&t=${Date.now()}`;
            
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`خطأ في جلب البيانات: ${response.status}`);
                }
                
                const data = await response.arrayBuffer();
                const workbook = XLSX.read(data, { type: 'array' });
                const sheet = workbook.Sheets[workbook.SheetNames[0]];
                const jsonData = XLSX.utils.sheet_to_json(sheet, { header: 1, defval: "" });
                
                allListings = [];
                for (let i = 0; i < jsonData.length; i += 7) {
                    const row = jsonData.slice(i, i + 7);
                    
                    if (row[0] && row[0].toString().trim() !== "") {
                        allListings.push({
                            فيديو: row[0]?.toString().trim() || "",
                            السعر: parseInt(row[1]) || 0,
                            الوصف: row[2]?.toString().trim() || "لا يوجد وصف",
                            المنطقة: row[3]?.toString().trim() || "غير معروف",
                            جاهز: (row[4]?.toString().trim().toUpperCase() === "T") ? "T" : "F",
                            الإعجابات: parseInt(row[5]) || 0,
                            التعليقات: row[6]?.toString().trim() || ""
                        });
                    }
                }
                
                // تحديث العداد
                document.getElementById('propertyCount').textContent = `${allListings.length} `;
                document.getElementById('loadingMessage').style.display = 'none';
                
                applyFilters();
            } catch (error) {
                console.error("حدث خطأ أثناء تحميل البيانات:", error);
                document.getElementById('loadingMessage').innerHTML = `
                    <div class="error-display">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h3>حدث خطأ أثناء تحميل البيانات</h3>
                        <p>${error.message}</p>
                        <button onclick="fetchData()" style="margin-top:10px; padding:8px 16px; background:#1877f2; color:white; border:none; border-radius:6px; cursor:pointer;">
                            إعادة المحاولة
                        </button>
                    </div>
                `;
            }
        }
        
        // تطبيق الفلاتر
        function applyFilters() {
            const priceFilter = document.getElementById("priceFilter").value;
            const readyFilter = document.getElementById("readyFilter").value;
            const areaFilter = document.getElementById("areaFilter").value;
            
            const filteredListings = allListings.filter(item => {
                let priceMatch = false;
                if (priceFilter === "all") priceMatch = true;
                else if (priceFilter === "5000-10000" && item.السعر >= 5000 && item.السعر <= 10000) priceMatch = true;
                else if (priceFilter === "10000-15000" && item.السعر > 10000 && item.السعر <= 15000) priceMatch = true;
                else if (priceFilter === "15000+" && item.السعر > 15000) priceMatch = true;
                
                const readyMatch = readyFilter === "all" || item.جاهز === readyFilter;
                const areaMatch = areaFilter === "all" || item.المنطقة === areaFilter;
                
                return priceMatch && readyMatch && areaMatch;
            });
            
            displayListings(filteredListings);
        }
        
        // إنشاء رابط واتساب مع الوصف ورابط الفيديو
        function createWhatsAppLink(description, videoUrl, price, area, status) {
            // تنظيف رقم الهاتف
            const phoneNumber = WHATSAPP_NUMBER.replace(/\D/g, '');
            
            // تحضير الرسالة
            const statusText = status === "T" ? "جاهز" : "تحت الإنشاء";
            const areaName = getAreaName(area);
            
            const message = `مرحباً، أنا مهتم بالعقار التالي:

${description}

- السعر: ${price.toLocaleString()} $
- المنطقة: ${areaName}
- الحالة: ${statusText}
- رابط الفيديو: ${videoUrl}

أود الاستفسار عن المزيد من التفاصيل.`;

            // ترميز الرسالة
            const encodedMessage = encodeURIComponent(message);
            
            // إنشاء رابط الواتساب
            return `https://wa.me/${phoneNumber}?text=${encodedMessage}`;
        }
        
        // عرض العقارات
        function displayListings(data) {
            const listingsContainer = document.getElementById('listingsContainer');
            
            if (data.length === 0) {
                listingsContainer.innerHTML = `
                    <div class="no-results">
                        <i class="far fa-folder-open"></i>
                        <h3>لا توجد عقارات مطابقة</h3>
                        <p>حاول تغيير معايير البحث</p>
                    </div>
                `;
                return;
            }
            
            let listingsHTML = '';
            
            data.forEach((item, index) => {
                const videoUrl = parseVideoUrl(item.فيديو);
                const originalVideoUrl = item.فيديو || "";
                
                // إنشاء رابط واتساب لهذا العقار
                const whatsappLink = createWhatsAppLink(
                    item.الوصف,
                    originalVideoUrl,
                    item.السعر,
                    item.المنطقة,
                    item.جاهز
                );
                
                let commentsHTML = '<p>لا توجد تعليقات</p>';
                if (item.التعليقات && item.التعليقات.trim() !== "") {
                    commentsHTML = item.التعليقات.split('|')
                        .filter(comment => comment.trim() !== "")
                        .map(comment => `<div class="comment-item">${comment.trim()}</div>`)
                        .join('');
                }
                
                listingsHTML += `
                    <div class="listing-card">
                        <div class="video-container">
                            ${videoUrl ? `
                            <iframe src="${videoUrl}" 
                                    frameborder="0" 
                                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                    allowfullscreen></iframe>
                            ` : '<div style="display:flex; align-items:center; justify-content:center; height:100%; color:#fff; background:#000;">رابط الفيديو غير متوفر</div>'}
                        </div>
                        
                        <div class="listing-content">
                            <div class="listing-header">
                                <h3 class="listing-title">${item.الوصف}</h3>
                                <div class="price-tag">${item.السعر.toLocaleString()} $</div>
                            </div>
                            
                            <div class="listing-details">
                                <div class="detail-item">
                                    <i class="fas fa-map-marker-alt detail-icon"></i>
                                    <span>${getAreaName(item.المنطقة)}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="status-badge ${item.جاهز === "T" ? 'status-ready' : 'status-not-ready'}">
                                        ${item.جاهز === "T" ? 'جاهز' : 'تحت الإنشاء'}
                                    </span>
                                </div>
                                <div class="detail-item">
                                    <i class="fas fa-thumbs-up detail-icon"></i>
                                    <span>${item.الإعجابات}</span>
                                </div>
                            </div>
                            
                            <div class="action-buttons">
                                <button class="action-btn like-btn" onclick="likeListing(${index}, event)">
                                    <i class="fas fa-thumbs-up"></i> أعجبني (${item.الإعجابات})
                                </button>
                                <button class="action-btn comment-btn" onclick="showCommentForm(${index})">
                                    <i class="fas fa-comment"></i> تعليق
                                </button>
                                <button class="action-btn view-comments-btn" onclick="toggleComments(${index})">
                                    <i class="fas fa-eye"></i> عرض
                                </button>
                            </div>
                            
                            <a class="whatsapp-btn" href="${whatsappLink}" target="_blank">
                                <i class="fab fa-whatsapp"></i> تواصل عبر واتساب
                            </a>
                            
                            <div class="comments-section" id="comments-${index}">
                                <div class="comments-header">
                                    <h4 class="comments-title">التعليقات</h4>
                                </div>
                                
                                <div class="comments-list">
                                    ${commentsHTML}
                                </div>
                                
                                <div class="comment-form" id="commentForm-${index}" style="display:none;">
                                    <textarea class="comment-textarea" id="commentText-${index}" placeholder="اكتب تعليقك هنا..."></textarea>
                                    <button class="submit-comment-btn" onclick="submitComment(${index}, event)">
                                        <i class="fas fa-paper-plane"></i> إرسال
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            listingsContainer.innerHTML = listingsHTML;
        }
        
        // التحقق من كلمة السر
        function checkSecretCode() {
            const secretCode = document.getElementById('secretCodeInput').value;
            const codeResult = document.getElementById('codeResult');
            
            if (secretCode === 'jlal20022') {
                codeResult.innerHTML = `
                    <i class="fas fa-check-circle"></i> تم التحقق بنجاح! يمكنك الآن إضافة عقار جديد
                `;
                codeResult.className = 'result-message success-message';
                codeResult.style.display = 'block';
                
                // إظهار نموذج الإضافة
                document.getElementById('addFormContainer').classList.add('active');
                
                // مسح حقل الإدخال
                document.getElementById('secretCodeInput').value = '';
                
                // إخفاء الرسالة بعد 5 ثوانٍ
                setTimeout(() => {
                    codeResult.style.display = 'none';
                }, 5000);
            } else {
                codeResult.innerHTML = `
                    <i class="fas fa-times-circle"></i> كلمة المرور غير صحيحة
                `;
                codeResult.className = 'result-message error-message';
                codeResult.style.display = 'block';
                
                // تأثير اهتزاز
                document.getElementById('secretCodeInput').style.animation = 'none';
                setTimeout(() => {
                    document.getElementById('secretCodeInput').style.animation = 'shake 0.5s';
                }, 10);
                
                // إخفاء الرسالة بعد 3 ثوانٍ
                setTimeout(() => {
                    codeResult.style.display = 'none';
                }, 3000);
            }
        }
        
        // إظهار/إخفاء التعليقات
        function toggleComments(index) {
            const commentsDiv = document.getElementById(`comments-${index}`);
            if (commentsDiv) {
                commentsDiv.classList.toggle('expanded');
            }
        }
        
        // إظهار نموذج التعليق
        function showCommentForm(index) {
            const commentForm = document.getElementById(`commentForm-${index}`);
            if (commentForm) {
                commentForm.style.display = commentForm.style.display === 'none' ? 'block' : 'none';
            }
            
            // عرض قسم التعليقات
            const commentsDiv = document.getElementById(`comments-${index}`);
            if (commentsDiv) {
                commentsDiv.classList.add('expanded');
            }
        }
        
        // إضافة إعجاب
        async function likeListing(index, event) {
            try {
                const likeButton = event.target;
                likeButton.disabled = true;
                
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams({
                        action: "like",
                        row: (index * 7) + 6
                    })
                });
                
                if (!response.ok) {
                    throw new Error("فشل في تسجيل الإعجاب");
                }
                
                const result = await response.text();
                if (result.includes("تم")) {
                    const currentLikes = parseInt(likeButton.textContent.match(/\((\d+)\)/)[1]) || 0;
                    likeButton.innerHTML = `<i class="fas fa-thumbs-up"></i> أعجبني (${currentLikes + 1})`;
                }
            } catch (error) {
                console.error("Error:", error);
            } finally {
                event.target.disabled = false;
            }
        }
        
        // إرسال تعليق جديد
        async function submitComment(index, event) {
            event.preventDefault();
            
            const commentText = document.getElementById(`commentText-${index}`).value.trim();
            const commentButton = event.target;
            
            if (!commentText) return;
            
            try {
                commentButton.disabled = true;
                commentButton.innerHTML = `<i class="fas fa-spinner fa-spin"></i> جاري الإرسال...`;
                
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams({
                        action: "comment",
                        row: (index * 7) + 7,
                        value: commentText
                    })
                });
                
                if (!response.ok) {
                    throw new Error("فشل في إضافة التعليق");
                }
                
                // تحديث الواجهة
                const commentsList = document.querySelector(`#comments-${index} .comments-list`);
                
                // إنشاء تعليق جديد
                const commentElement = document.createElement('div');
                commentElement.className = 'comment-item';
                commentElement.textContent = commentText;
                
                // إضافة التعليق
                if (commentsList.querySelector('p:first-child')?.textContent === 'لا توجد تعليقات') {
                    commentsList.innerHTML = '';
                }
                commentsList.appendChild(commentElement);
                
                // مسح الحقل وإخفاء النموذج
                document.getElementById(`commentText-${index}`).value = '';
                document.getElementById(`commentForm-${index}`).style.display = 'none';
                
            } catch (error) {
                console.error("Error:", error);
            } finally {
                commentButton.disabled = false;
                commentButton.innerHTML = `<i class="fas fa-paper-plane"></i> إرسال`;
            }
        }
        
        // دالة لجلب البيانات الحالية
        async function fetchCurrentData() {
            const url = `https://docs.google.com/spreadsheets/d/${GOOGLE_SHEET_ID}/export?format=xlsx&t=${Date.now()}`;
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`خطأ في جلب البيانات: ${response.status}`);
            }
            
            const data = await response.arrayBuffer();
            const workbook = XLSX.read(data, { type: 'array' });
            const sheet = workbook.Sheets[workbook.SheetNames[0]];
            return XLSX.utils.sheet_to_json(sheet, { header: 1, defval: "" });
        }
        
        // إعداد البيانات الجديدة
        function prepareNewData(currentData, formData) {
            const newListing = [
                formData.videoUrl1,
                formData.price1,
                formData.description1,
                formData.region1,
                formData.ready1 === "T" ? "T" : "F",
                0,
                ""
            ];
            
            const allListings = [];
            for (let i = 0; i < currentData.length; i += 7) {
                const listing = currentData.slice(i, i + 7);
                if (listing[0] && listing[0].toString().trim() !== "") {
                    allListings.push(listing);
                }
            }
            
            allListings.unshift(newListing);
            
            const updatedData = [];
            allListings.forEach(listing => {
                while (listing.length < 7) {
                    listing.push("");
                }
                updatedData.push(...listing.slice(0, 7));
            });
            
            return updatedData;
        }
        
        // معالجة إرسال النموذج
        async function handleFormSubmit(e) {
            e.preventDefault();
            
            const formData = {
                videoUrl1: document.getElementById('videoUrl1').value.trim(),
                price1: document.getElementById('price1').value.trim(),
                description1: document.getElementById('description1').value.trim(),
                region1: document.getElementById('region1').value,
                ready1: document.querySelector('input[name="ready1"]:checked').value
            };
            
            if (!formData.videoUrl1 || !formData.price1 || !formData.description1 || !formData.region1) {
                document.getElementById('formResult').innerHTML = `
                    <div class="error-display">
                        <i class="fas fa-exclamation-circle"></i>
                        الرجاء ملء جميع الحقول المطلوبة
                    </div>
                `;
                return;
            }
            
            try {
                const submitBtn = document.querySelector('#dataForm .submit-btn');
                const originalText = submitBtn.innerHTML;
                submitBtn.innerHTML = `<i class="fas fa-spinner fa-spin"></i> جاري الإضافة...`;
                submitBtn.disabled = true;
                
                // جلب البيانات الحالية
                const currentData = await fetchCurrentData();
                
                // تحضير البيانات المحدثة
                const updatedData = prepareNewData(currentData, formData);
                
                // إرسال البيانات
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams({
                        action: "updateSheet",
                        data: JSON.stringify(updatedData)
                    })
                });
                
                if (!response.ok) {
                    throw new Error("فشل في إضافة العقار");
                }
                
                document.getElementById('formResult').innerHTML = `
                    <div class="success-display">
                        <i class="fas fa-check-circle"></i>
                        تم إضافة العقار بنجاح
                    </div>
                `;
                
                // إعادة تعيين النموذج
                document.getElementById('dataForm').reset();
                
                // تحديث البيانات بعد ثانيتين
                setTimeout(() => {
                    fetchData();
                    document.getElementById('formResult').innerHTML = '';
                }, 2000);
                
            } catch (error) {
                console.error("Error:", error);
                document.getElementById('formResult').innerHTML = `
                    <div class="error-display">
                        <i class="fas fa-exclamation-triangle"></i>
                        ${error.message}
                    </div>
                `;
            } finally {
                const submitBtn = document.querySelector('#dataForm .submit-btn');
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        }
        
        // تأثير الاهتزاز
        const style = document.createElement('style');
        style.textContent = `
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
                20%, 40%, 60%, 80% { transform: translateX(5px); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>